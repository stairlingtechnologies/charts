apiVersion: batch/v1
kind: CronJob
metadata:
  name: update-postgres-ca-cert
  labels:
    application: stairling
    component: transfer-creation
    {{ include "stairling.labels" . | nindent 4 }}
spec:
  concurrencyPolicy: Allow
  failedJobsHistoryLimit: 1
  jobTemplate:
    spec:
      template:
        metadata:
          annotations:
            {{- if .Values.vault.enabled }}
            vault.security.banzaicloud.io/vault-addr: {{ .Values.vault.url | quote }}
            vault.security.banzaicloud.io/vault-role: {{ .Values.vault.role | quote }}
            vault.security.banzaicloud.io/vault-skip-verify: {{ .Values.vault.skipVerify | quote }}
            {{- if and .Values.vault.envFrom.enabled .Values.vault.envFrom.path }}
            vault.security.banzaicloud.io/vault-env-from-path: {{ .Values.vault.envFrom.path }}
            {{- end }}
            {{- end }}
        spec:
          containers:
            - image: w6dio/kubectl:1.6.1-slim
              imagePullPolicy: IfNotPresent
              name: updater
              resources: {}
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
          dnsPolicy: ClusterFirst
          restartPolicy: OnFailure
          schedulerName: default-scheduler
          securityContext: {}
          serviceAccount: postgres-ca-updater
          serviceAccountName: postgres-ca-updater
          terminationGracePeriodSeconds: 30
  schedule: 0 9 * * 1-5
  successfulJobsHistoryLimit: 3
  suspend: false